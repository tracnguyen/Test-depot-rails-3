%h1 Job Stages


%ul{:id => 'sortable'}
  .col1
    .editable.col11{:id => @first_stage.id}
      = @first_stage.name
    .col12
      &nbsp;
    .col13
      .controlset
        %input{:class => "color", :type => "text", :value => @first_stage.color}

  .col2
    (default)
  - @job_stages.each do |job_stage|
    %li{:id => "order_#{job_stage.id}"}
      .col1
        .editable.col11{:id => job_stage.id}
          = job_stage.name
        .col12
          = link_to image_tag("delete-icon.png"), config_job_stage_path(job_stage), :confirm => 'Are you sure?', :method => :delete
        .col13
          .controlset
            %input{:class => "color", :type => "text", :value => job_stage.color}

.clearfix

.button
  = link_to 'New job stage', new_config_job_stage_path


:erb
  <script type='text/javascript'>
    $(document).ready(function() {
      $('.editable').inlineEdit({
        save: function(e, data) {
          $.ajax({
            type: 'PUT',
            url: '/config/job_stages/' + e.currentTarget.id,
            data: {
              'job_stage[name]' : data.value,
            }, 
            success: function(){
              $('#notice').text('Stage was successfully updated.')
            }
          })
        }
      });
      
      $('#sortable').sortable({
        items: 'li',
        update: function(e, data) {
          var order = $('#sortable').sortable('serialize');
          $.ajax({
            type: 'POST',
            url: '/config/job_stages/order',
            data: order,
            success: function(data){
              alert('hello');
            }
          })
        }
      });
      
      $('.color').colorPicker();
      
    })
  </script>
